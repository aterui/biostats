<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 22 Time-Series Analaysis | BIOSTATS</title>
<meta name="author" content="Akira Terui">
<meta name="description" content="pacman::p_load(tidyverse,        forecast)  22.1 Pitfall of Time-Series  22.1.1 Time-series anormalies Let’s explore a simple time series dataset, showing air-quality anomalies measured over 100...">
<meta name="generator" content="bookdown 0.43 with bs4_book()">
<meta property="og:title" content="Chapter 22 Time-Series Analaysis | BIOSTATS">
<meta property="og:type" content="book">
<meta property="og:description" content="pacman::p_load(tidyverse,        forecast)  22.1 Pitfall of Time-Series  22.1.1 Time-series anormalies Let’s explore a simple time series dataset, showing air-quality anomalies measured over 100...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 22 Time-Series Analaysis | BIOSTATS">
<meta name="twitter:description" content="pacman::p_load(tidyverse,        forecast)  22.1 Pitfall of Time-Series  22.1.1 Time-series anormalies Let’s explore a simple time series dataset, showing air-quality anomalies measured over 100...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QZSNHVQQNV"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QZSNHVQQNV');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">BIOSTATS</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li class="book-part">Getting Started</li>
<li><a class="" href="what-is-r-and-r-studio.html"><span class="header-section-number">1</span> What is R and R studio?</a></li>
<li><a class="" href="installing-r-and-rstudio.html"><span class="header-section-number">2</span> Installing R and RStudio</a></li>
<li><a class="" href="r-project.html"><span class="header-section-number">3</span> R Project</a></li>
<li class="book-part">R Basics</li>
<li><a class="" href="data-structure.html"><span class="header-section-number">4</span> Data Structure</a></li>
<li><a class="" href="data-manipulation.html"><span class="header-section-number">5</span> Data Manipulation</a></li>
<li><a class="" href="visualization.html"><span class="header-section-number">6</span> Visualization</a></li>
<li class="book-part">Basic Statistics</li>
<li><a class="" href="descriptive-statistics.html"><span class="header-section-number">7</span> Descriptive Statistics</a></li>
<li><a class="" href="sampling.html"><span class="header-section-number">8</span> Sampling</a></li>
<li><a class="" href="probabilistic-view.html"><span class="header-section-number">9</span> Probabilistic View</a></li>
<li><a class="" href="two-group-comparison.html"><span class="header-section-number">10</span> Two-Group Comparison</a></li>
<li><a class="" href="multiple-group-comparison.html"><span class="header-section-number">11</span> Multiple-Group Comparison</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">12</span> Regression</a></li>
<li><a class="" href="linear-model.html"><span class="header-section-number">13</span> Linear Model</a></li>
<li><a class="" href="generalized-linear-model.html"><span class="header-section-number">14</span> Generalized Linear Model</a></li>
<li><a class="" href="likelihood.html"><span class="header-section-number">15</span> Likelihood</a></li>
<li><a class="" href="model-comparison.html"><span class="header-section-number">16</span> Model Comparison</a></li>
<li class="book-part">Applied Statistics</li>
<li><a class="" href="generalized-linear-mixed-effect-model.html"><span class="header-section-number">17</span> Generalized Linear Mixed Effect Model</a></li>
<li><a class="" href="generalized-additive-model.html"><span class="header-section-number">18</span> Generalized Additive Model</a></li>
<li><a class="" href="unconstrained-ordination.html"><span class="header-section-number">19</span> Unconstrained Ordination</a></li>
<li><a class="" href="constrained-ordination.html"><span class="header-section-number">20</span> Constrained Ordination</a></li>
<li><a class="" href="structural-equation-modeling.html"><span class="header-section-number">21</span> Structural Equation Modeling</a></li>
<li><a class="active" href="time-series-analaysis.html"><span class="header-section-number">22</span> Time-Series Analaysis</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="basic-terminology.html"><span class="header-section-number">23</span> Basic Terminology</a></li>
<li><a class="" href="git-github.html">Git &amp; GitHub</a></li>
<li><a class="" href="base-plot.html">Base Plot</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/aterui/biostats">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="time-series-analaysis" class="section level1" number="22">
<h1>
<span class="header-section-number">22</span> Time-Series Analaysis<a class="anchor" aria-label="anchor" href="#time-series-analaysis"><i class="fas fa-link"></i></a>
</h1>
<div class="sourceCode" id="cb569"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>,</span>
<span>               <span class="va">forecast</span><span class="op">)</span></span></code></pre></div>
<div id="pitfall-of-time-series" class="section level2" number="22.1">
<h2>
<span class="header-section-number">22.1</span> Pitfall of Time-Series<a class="anchor" aria-label="anchor" href="#pitfall-of-time-series"><i class="fas fa-link"></i></a>
</h2>
<div id="time-series-anormalies" class="section level3" number="22.1.1">
<h3>
<span class="header-section-number">22.1.1</span> Time-series anormalies<a class="anchor" aria-label="anchor" href="#time-series-anormalies"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s explore a simple time series dataset, showing air-quality anomalies measured over 100 years.</p>
<div class="sourceCode" id="cb570"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/aterui/biostats/master/data_raw/data_ts_anormaly.csv"</span></span>
<span><span class="op">(</span><span class="va">df_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 100 × 2
##    anormaly  year
##       &lt;dbl&gt; &lt;dbl&gt;
##  1    0      1926
##  2   -0.560  1927
##  3   -0.791  1928
##  4    0.768  1929
##  5    0.839  1930
##  6    0.968  1931
##  7    2.68   1932
##  8    3.14   1933
##  9    1.88   1934
## 10    1.19   1935
## # ℹ 90 more rows</code></pre>
<p>The plot of this dataset shows that air-quality anomalies tend to increase over time.</p>
<div class="sourceCode" id="cb572"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot time-series anomalies</span></span>
<span><span class="va">df_ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,          <span class="co"># Map 'year' to the x-axis</span></span>
<span>             y <span class="op">=</span> <span class="va">anormaly</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Map 'anormaly' to the y-axis</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                  <span class="co"># Add a line connecting the points</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                 <span class="co"># Add points at each observation</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                   <span class="co"># Use a clean black-and-white theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,                     <span class="co"># Label x-axis</span></span>
<span>    y <span class="op">=</span> <span class="st">"Anomaly"</span>                   <span class="co"># Label y-axis</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:adv-06-random-walk-plot"></span>
<img src="biostats_files/figure-html/adv-06-random-walk-plot-1.png" alt="Time-series of annual anomalies. Points represent observed values for each year, and lines connect consecutive observations to highlight temporal trends." width="672"><p class="caption">
Figure 22.1: Time-series of annual anomalies. Points represent observed values for each year, and lines connect consecutive observations to highlight temporal trends.
</p>
</div>
<p>Providing statistical evidence appears straightforward — we can simply regress anomalies on time.</p>
<div class="sourceCode" id="cb573"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit a simple linear model: anomaly as a function of year</span></span>
<span><span class="va">m_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">anormaly</span> <span class="op">~</span> <span class="va">year</span>, data <span class="op">=</span> <span class="va">df_ts</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the model summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m_lm</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = anormaly ~ year, data = df_ts)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.0830 -1.1333 -0.1559  1.2911  5.6330 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -90.770684  12.715802  -7.138 1.66e-10 ***
## year          0.047154   0.006436   7.327 6.73e-11 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.858 on 98 degrees of freedom
## Multiple R-squared:  0.3539, Adjusted R-squared:  0.3473 
## F-statistic: 53.68 on 1 and 98 DF,  p-value: 6.729e-11</code></pre>
<p>There is a strong, positive effect of observation year, with a slope estimate of 0.04, indicating that anomalies increase by 0.04 per year on average.</p>
<div class="sourceCode" id="cb575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, </span>
<span>             y <span class="op">=</span> <span class="va">anormaly</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Set up the plot: x = year, y = anomaly</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span>     <span class="co"># Draw a dotted line connecting the points</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span>           <span class="co"># Add points with transparency (alpha = 0.25)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">m_lm</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,  <span class="co"># Add regression line from linear model</span></span>
<span>              slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">m_lm</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>                             <span class="co"># Use a clean black-and-white theme</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:adv-06-lm-fit-plot"></span>
<img src="biostats_files/figure-html/adv-06-lm-fit-plot-1.png" alt="Time-series of anomalies over years. Dotted lines connect consecutive observations, semi-transparent points show individual measurements, and the solid line represents the fitted linear trend from a linear regression model." width="672"><p class="caption">
Figure 22.2: Time-series of anomalies over years. Dotted lines connect consecutive observations, semi-transparent points show individual measurements, and the solid line represents the fitted linear trend from a linear regression model.
</p>
</div>
<p>The regression line may appear to fit the data well, with no obvious issues. However, if you think that, <strong>you have already fallen into a common pitfall of time-series analysis</strong> — this type of analysis has many potential problems.</p>
</div>
<div id="temporal-autocorrelation" class="section level3" number="22.1.2">
<h3>
<span class="header-section-number">22.1.2</span> Temporal autocorrelation<a class="anchor" aria-label="anchor" href="#temporal-autocorrelation"><i class="fas fa-link"></i></a>
</h3>
<p>While the data appear to show an increasing trend, this dataset was generated from a simulation that assumes <strong>NO</strong> true temporal increase — it was produced through a process known as a <strong>random walk</strong>.</p>
<p><span class="math display">\[
y_t = y_{t-1} + \varepsilon_{t}\\
\varepsilon_t \sim \text{Normal}(0, \sigma^2)
\]</span></p>
<p>This system is unique because each observation depends on its immediate past: the previous value (<span class="math inline">\(y_{t-1}\)</span>) plus noise (<span class="math inline">\(\varepsilon_t\)</span>) produces the current value (<span class="math inline">\(y_t\)</span>).</p>
<p>The behavior of a random walk is highly stochastic, producing very different patterns in each simulation run. You can observe this by running the following code, which generated the dataset shown above.</p>
<div class="sourceCode" id="cb576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize a vector to store the time series (100 time steps)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate random noise for each time step</span></span>
<span><span class="va">eps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set the initial condition of the time series</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Generate a random walk:</span></span>
<span><span class="co"># each value equals the previous value plus random noise</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">y</span><span class="op">[</span><span class="va">t</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">+</span> <span class="va">eps</span><span class="op">[</span><span class="va">t</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Combine the time series with a corresponding year variable</span></span>
<span><span class="va">df_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  anormaly <span class="op">=</span> <span class="va">y</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">1925</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot time-series anomalies (not shown)</span></span>
<span><span class="va">df_y</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,</span>
<span>             y <span class="op">=</span> <span class="va">anormaly</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>              </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>             </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>               </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,              </span>
<span>    y <span class="op">=</span> <span class="st">"Anomaly"</span>            </span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This is expected because we are measuring the same object over time, so the observations are not independent. This leads to <strong>temporal autocorrelation</strong>, a feature that violates a fundamental assumption of many statistical methods — the independence of data points. Temporal autocorrelation can be assessed using the <code><a href="https://rdrr.io/r/stats/acf.html">acf()</a></code> function in R:</p>
<div class="sourceCode" id="cb577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Data must be ordered from the oldest observation to the most recent</span></span>
<span><span class="va">df_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">df_ts</span>, <span class="va">year</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html">acf</a></span><span class="op">(</span><span class="va">df_ts</span><span class="op">$</span><span class="va">anormaly</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:adv-06-acf-plot"></span>
<img src="biostats_files/figure-html/adv-06-acf-plot-1.png" alt="Autocorrelation function plot. The x-axis represents the lag, or the time difference between observations (e.g., lag 1 is the correlation between consecutive observations, lag 2 is two steps apart, etc.), while the y-axis shows the autocorrelation coefficient, ranging from -1 to 1, indicating how strongly observations at that lag are correlated." width="672"><p class="caption">
Figure 22.3: Autocorrelation function plot. The x-axis represents the lag, or the time difference between observations (e.g., lag 1 is the correlation between consecutive observations, lag 2 is two steps apart, etc.), while the y-axis shows the autocorrelation coefficient, ranging from -1 to 1, indicating how strongly observations at that lag are correlated.
</p>
</div>
<p>In an ACF (autocorrelation function) plot, the x-axis represents the lag, or the time difference between observations (e.g., lag 1 is the correlation between consecutive observations, lag 2 is two steps apart, etc.), while the y-axis shows the autocorrelation coefficient, ranging from -1 to 1, indicating how strongly observations at that lag are correlated.</p>
<p>Positive values mean observations tend to move in the same direction as previous ones, negative values indicate opposite movement, and values near zero suggest little or no correlation. The dashed lines represent approximate confidence bounds, so spikes outside these lines indicate statistically significant correlations at that lag.</p>
<p>Treating temporally correlated measurements as independent can seriously compromise statistical inference and lead to unsupported conclusions.</p>
<p>Below, we explore how to accommodate the challenging nature of time-series data using basic models, and how these models can be extended to assess the influence of external factors that also change over time in biological data analysis.</p>
</div>
</div>
<div id="basic-models" class="section level2" number="22.2">
<h2>
<span class="header-section-number">22.2</span> Basic Models<a class="anchor" aria-label="anchor" href="#basic-models"><i class="fas fa-link"></i></a>
</h2>
<p>As a starting point, we will focus on AR, MA, and ARMA models, all of which assume a stationary process. We will then extend these frameworks to the ARIMA model, which incorporates an integration step to handle non-stationary time series.</p>
<p>Stationarity is a fundamental concept in time-series analysis: a stationary process has a constant mean, variance, and autocorrelation structure over time. Non-stationarity means that one or more of these properties change through time—for example, the series may exhibit trends, shifts in variability, or evolving temporal dependence—making direct modeling and inference more challenging without first transforming the data.</p>
<p>We will use the built-in <code>LakeHuron</code> dataset to learn the implementation of these modeling approaches. All of the models discussed above can be implemented using the <code>Arima()</code> function from the <code>forecast</code> package, since AR, MA, and ARMA models are all special cases of the more general ARIMA framework.</p>
<div class="sourceCode" id="cb578"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a tibble (modern data frame) from the LakeHuron time series</span></span>
<span><span class="va">df_huron</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/time.html">time</a></span><span class="op">(</span><span class="va">LakeHuron</span><span class="op">)</span>,                <span class="co"># Extracts the time component (years) from the LakeHuron ts object</span></span>
<span>  water_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">LakeHuron</span><span class="op">)</span>    <span class="co"># Converts LakeHuron values to numeric (from ts class)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>                           <span class="co"># Ensures the data is ordered by year</span></span>
<span></span>
<span><span class="co"># Plot Lake Huron time series with a linear trend</span></span>
<span><span class="va">df_huron</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">water_level</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span>       <span class="co"># Semi-transparent points</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Dotted line connecting points</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>,       <span class="co"># Linear trend line</span></span>
<span>              color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Water Level"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:adv-06-huron-plot"></span>
<img src="biostats_files/figure-html/adv-06-huron-plot-1.png" alt="Time series of Lake Huron water levels from 1875 to 1972. Points represent annual water levels, and the dotted line connects consecutive observations. The solid black line shows a linear trend for reference only, providing a visual guide to the overall direction of change and facilitating comparison with predictions from time-series models." width="672"><p class="caption">
Figure 22.4: Time series of Lake Huron water levels from 1875 to 1972. Points represent annual water levels, and the dotted line connects consecutive observations. The solid black line shows a linear trend for reference only, providing a visual guide to the overall direction of change and facilitating comparison with predictions from time-series models.
</p>
</div>
<div id="ar-model" class="section level3" number="22.2.1">
<h3>
<span class="header-section-number">22.2.1</span> AR Model<a class="anchor" aria-label="anchor" href="#ar-model"><i class="fas fa-link"></i></a>
</h3>
<p>An autoregressive (AR) model describes a time series in which the current value depends on one or more of its past values plus random noise.</p>
<p><span class="math display">\[
y_t = \mu + \sum_{i=1}^p \phi_i y_{t - i} + \varepsilon_t
\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the constant term (intercept), <span class="math inline">\(\phi_i\)</span> is the autoregressive parameter, and <span class="math inline">\(\varepsilon_t\)</span> is the (white) noise.</p>
<p>In an AR(<span class="math inline">\(p\)</span>) model, the present observation is a linear combination of the previous <span class="math inline">\(p\)</span> observations. The <span class="math inline">\(p\)</span> is referred to as the <strong>order</strong> of the model. AR models are stationary when the sum of autoregressive parameters <span class="math inline">\(\sum_i \phi_i\)</span> are less than one – this is analogous to population models with a carrying capacity in ecology.</p>
<p>In practice, we supply a vector of time-series data to the <code><a href="https://rdrr.io/r/stats/arima.html">arima()</a></code> function. We will begin with the simplest autoregressive model of order one, which is specified by setting the first element of the <code>order</code> argument to 1 (i.e., <code>order = c(1, 0, 0)</code>).</p>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">m_ar1</span> <span class="op">&lt;-</span> <span class="fu">Arima</span><span class="op">(</span></span>
<span>  <span class="va">df_huron</span><span class="op">$</span><span class="va">water_level</span>,       <span class="co"># The time series data we want to model</span></span>
<span>  order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>          <span class="co"># ARIMA model orders: c(p, d, q)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Series: df_huron$water_level 
## ARIMA(1,0,0) with non-zero mean 
## 
## Coefficients:
##          ar1      mean
##       0.8375  579.1153
## s.e.  0.0538    0.4240
## 
## sigma^2 = 0.5199:  log likelihood = -106.6
## AIC=219.2   AICc=219.45   BIC=226.95</code></pre>
<p>This setup corresponds to setting the order (<span class="math inline">\(p = 1\)</span>) in an AR model, meaning the process “remembers” the previous observation. The remaining elements of the <code>order</code> argument define the other components of the model, which are relevant for the additional models introduced below.</p>
<p>We can extract the in-sample fitted values from the AR(1) model using the <code><a href="https://rdrr.io/r/stats/fitted.values.html">fitted()</a></code> function. Below, we compare these model predictions with a simple linear trend to illustrate how the time-series model captures temporal dependence beyond what a linear model provides.</p>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add fitted values from AR(1) model to the dataset</span></span>
<span><span class="va">df_huron_ar1</span> <span class="op">&lt;-</span> <span class="va">df_huron</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">m_ar1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>   <span class="co"># Extract fitted (in-sample predicted) values from the AR(1) model</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>           <span class="co"># Convert to numeric if necessary</span></span>
<span></span>
<span><span class="co"># Plot observed and fitted values</span></span>
<span><span class="va">df_huron_ar1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, </span>
<span>                 y <span class="op">=</span> <span class="va">water_level</span><span class="op">)</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span>        <span class="co"># Plot observed water levels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, </span>
<span>                y <span class="op">=</span> <span class="va">fit</span><span class="op">)</span>,           <span class="co"># Plot AR(1) fitted values</span></span>
<span>            color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>                        <span class="co"># Clean black-and-white theme</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:adv-06-ar1-plot"></span>
<img src="biostats_files/figure-html/adv-06-ar1-plot-1.png" alt="Observed Lake Huron water levels (points) with in-sample fitted values from an AR(1) model (steelblue line). The AR(1) model captures temporal dependence in the series, providing a better representation of year-to-year variation than a simple linear trend." width="672"><p class="caption">
Figure 22.5: Observed Lake Huron water levels (points) with in-sample fitted values from an AR(1) model (steelblue line). The AR(1) model captures temporal dependence in the series, providing a better representation of year-to-year variation than a simple linear trend.
</p>
</div>
<p>AR models assume stationarity, meaning their expected values and variance remain constant over time. When projecting time-series data into the future, AR models can produce forecasts that account for temporal dependence, often giving a very different and more realistic picture than a simple linear trend.</p>
<p>The <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function preforms the projection with the <code>n.ahead</code> argument.</p>
<div class="sourceCode" id="cb582"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Forecast the next 50 time points using the AR(1) model</span></span>
<span><span class="va">p_ar1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m_ar1</span>, n.ahead <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>  </span>
<span><span class="co"># Returns predicted values (p_ar1$pred) and their standard errors (p_ar1$se)</span></span>
<span></span>
<span><span class="co"># Create a tibble for the forecasted values</span></span>
<span><span class="va">df_pred_ar1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">df_huron</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/time.html">time</a></span><span class="op">(</span><span class="va">p_ar1</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span>, <span class="co"># Map forecast time steps to actual years</span></span>
<span>  fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">p_ar1</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span>,                 <span class="co"># Forecasted water levels</span></span>
<span>  fit_se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">p_ar1</span><span class="op">$</span><span class="va">se</span><span class="op">)</span>                 <span class="co"># Associated standard errors</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine historical AR(1) fitted values and future forecasts, then plot</span></span>
<span><span class="va">df_huron_ar1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">df_pred_ar1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">water_level</span><span class="op">)</span>,  <span class="co"># Observed water levels (semi-transparent)</span></span>
<span>             alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,                   <span class="co"># Visualize forecast uncertainty</span></span>
<span>                  ymin <span class="op">=</span> <span class="va">fit</span> <span class="op">-</span> <span class="va">fit_se</span>,</span>
<span>                  ymax <span class="op">=</span> <span class="va">fit</span> <span class="op">+</span> <span class="va">fit_se</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>              color <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">fit</span><span class="op">)</span>,           <span class="co"># Fitted values for historical data + forecasts</span></span>
<span>            color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Water Level"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:adv-06-ar1-plot-pred"></span>
<img src="biostats_files/figure-html/adv-06-ar1-plot-pred-1.png" alt="Observed Lake Huron water levels (points) with AR(1) model fitted values and 50-year forecasts (steelblue line). The shaded grey ribbon represents ±1 standard error around the predictions, illustrating the uncertainty of the forecast. This visualization highlights how the AR(1) model captures temporal dependence and projects future values differently from a simple linear trend." width="672"><p class="caption">
Figure 22.6: Observed Lake Huron water levels (points) with AR(1) model fitted values and 50-year forecasts (steelblue line). The shaded grey ribbon represents ±1 standard error around the predictions, illustrating the uncertainty of the forecast. This visualization highlights how the AR(1) model captures temporal dependence and projects future values differently from a simple linear trend.
</p>
</div>
</div>
<div id="ma-model" class="section level3" number="22.2.2">
<h3>
<span class="header-section-number">22.2.2</span> MA Model<a class="anchor" aria-label="anchor" href="#ma-model"><i class="fas fa-link"></i></a>
</h3>
<p>A moving average (MA) model represents a time series as a function of past random noises rather than past observations. In an MA(q) model, the current value depends on the current and previous q error terms.</p>
<p><span class="math display">\[
y_t = \mu + \sum_{i=1}^q \theta_i \varepsilon_{t-i} + \varepsilon_t
\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the constant term (intercept), <span class="math inline">\(\theta_i\)</span> is the moving-average parameter, and <span class="math inline">\(\varepsilon_t\)</span> is the (white) noise. In the <code>Arima()</code> function, specifying <code>order = c(0, 0, 1)</code> corresponds to a moving-average model of order 1 (MA(1)), where the current value depends on the most recent random noise.</p>
<div class="sourceCode" id="cb583"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">m_ma1</span> <span class="op">&lt;-</span> <span class="fu">Arima</span><span class="op">(</span></span>
<span>  <span class="va">df_huron</span><span class="op">$</span><span class="va">water_level</span>,       <span class="co"># The time series data we want to model</span></span>
<span>  order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>          <span class="co"># ARIMA model orders: c(p, d, q)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Series: df_huron$water_level 
## ARIMA(0,0,1) with non-zero mean 
## 
## Coefficients:
##          ma1      mean
##       0.8302  578.9982
## s.e.  0.0633    0.1580
## 
## sigma^2 = 0.7517:  log likelihood = -124.65
## AIC=255.3   AICc=255.55   BIC=263.05</code></pre>
<p>We can perform a similar fitting, forecasting, and visualization for MA models, which highlights how their behavior differs from AR models. In particular, the average of the projected values quickly converges to the most recent observation. This occurs because MA models capture autocorrelation in the error terms, but the current value does not directly depend on past observations, unlike AR models.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:adv-06-ma1-plot"></span>
<img src="biostats_files/figure-html/adv-06-ma1-plot-1.png" alt="Observed Lake Huron water levels (points) with MA(1) model fitted values and 50-year forecasts (steelblue line). The shaded grey ribbon represents ±1 standard error around the predictions, illustrating the uncertainty of the forecast." width="672"><p class="caption">
Figure 22.7: Observed Lake Huron water levels (points) with MA(1) model fitted values and 50-year forecasts (steelblue line). The shaded grey ribbon represents ±1 standard error around the predictions, illustrating the uncertainty of the forecast.
</p>
</div>
</div>
<div id="arma-model" class="section level3" number="22.2.3">
<h3>
<span class="header-section-number">22.2.3</span> ARMA Model<a class="anchor" aria-label="anchor" href="#arma-model"><i class="fas fa-link"></i></a>
</h3>
<p>An ARMA model combines both autoregressive and moving-average components, allowing the current value to depend on both past observations and past random noises.</p>
<p><span class="math display">\[
y_t = \mu + \sum_{i=1}^p\phi_i y_{t-i} + \sum_{i=1}^q \theta_i\varepsilon_{t-i} + \varepsilon_t
\]</span></p>
<p>The parameters are defined as above. Since an ARMA model combines both AR and MA components, we specify <code>order = c(1, 0, 1)</code> to include first-order AR and MA terms, allowing the current value to depend on both the previous observation and the most recent random noise.</p>
<div class="sourceCode" id="cb585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">m_arma</span> <span class="op">&lt;-</span> <span class="fu">Arima</span><span class="op">(</span></span>
<span>  <span class="va">df_huron</span><span class="op">$</span><span class="va">water_level</span>,       <span class="co"># The time series data we want to model</span></span>
<span>  order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>          <span class="co"># ARIMA model orders: c(p, d, q)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Series: df_huron$water_level 
## ARIMA(1,0,1) with non-zero mean 
## 
## Coefficients:
##          ar1     ma1      mean
##       0.7449  0.3206  579.0555
## s.e.  0.0777  0.1135    0.3501
## 
## sigma^2 = 0.4899:  log likelihood = -103.25
## AIC=214.49   AICc=214.92   BIC=224.83</code></pre>
<p>We can visualize the ARMA(1,1) model in the same way as we did for the AR(1) and MA(1) models by combining historical fitted values with out-of-sample forecasts and displaying the uncertainty:</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:adv-06-arma-plot"></span>
<img src="biostats_files/figure-html/adv-06-arma-plot-1.png" alt="Observed Lake Huron water levels (points) with ARMA(1,1) model fitted values and 50-year forecasts (steelblue line). The shaded grey ribbon represents ±1 standard error around the predictions, illustrating the uncertainty of the forecast." width="672"><p class="caption">
Figure 22.8: Observed Lake Huron water levels (points) with ARMA(1,1) model fitted values and 50-year forecasts (steelblue line). The shaded grey ribbon represents ±1 standard error around the predictions, illustrating the uncertainty of the forecast.
</p>
</div>
</div>
<div id="arima-model" class="section level3" number="22.2.4">
<h3>
<span class="header-section-number">22.2.4</span> ARIMA model<a class="anchor" aria-label="anchor" href="#arima-model"><i class="fas fa-link"></i></a>
</h3>
<p>An ARIMA model can be thought of as an ARMA model applied to the differenced series. To illustrate, consider an ARIMA model with first-order differencing. We define a new variable: <span class="math inline">\(\delta_t = y_t - y_{t-1}\)</span>.</p>
<p>The ARIMA then fits an ARMA(p, q) model to <span class="math inline">\(\delta_t\)</span>, capturing the autoregressive and moving-average structure in the differenced (stationary) series:</p>
<p><span class="math display">\[
\delta_t = \sum_{i=1}^p \phi_i \delta_{t-i} + \sum_{i=1}^q \theta_i \varepsilon_{t-i} +\varepsilon_t
\]</span></p>
<p>This is a special case of the more general d-order ARIMA(p,d,q) model, specifically ARIMA(p,1,q) where <span class="math inline">\(d=1\)</span>. For more detailed explanations and examples, you can refer to well-developed documentation, such as <a href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average">Wikipedia</a></p>
<p>This extension allows ARIMA models to handle non-stationary time series, where the mean or trend changes over time.</p>
<p>Here, we assume <span class="math inline">\(p=1\)</span> and <span class="math inline">\(d=1\)</span> to illustrate and gain insights into how the ARIMA model operates.</p>
<div class="sourceCode" id="cb587"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">m_arima</span> <span class="op">&lt;-</span> <span class="fu">Arima</span><span class="op">(</span><span class="va">df_huron</span><span class="op">$</span><span class="va">water_level</span>,</span>
<span>                  order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Series: df_huron$water_level 
## ARIMA(1,1,0) 
## 
## Coefficients:
##          ar1
##       0.1362
## s.e.  0.1021
## 
## sigma^2 = 0.5544:  log likelihood = -108.23
## AIC=220.45   AICc=220.58   BIC=225.6</code></pre>
<p>No constant term is estimated because the series is first-order differenced. The visualization highlights how the shifting mean influences the model’s projections over time – the uncertainty is greater than stationary models.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:adv-06-arima-plot"></span>
<img src="biostats_files/figure-html/adv-06-arima-plot-1.png" alt="Observed Lake Huron water levels (points) with ARIMA(1,1,0) model fitted values and 50-year forecasts (steelblue line). The shaded grey ribbon represents ±1 standard error around the predictions, illustrating forecast uncertainty." width="672"><p class="caption">
Figure 22.9: Observed Lake Huron water levels (points) with ARIMA(1,1,0) model fitted values and 50-year forecasts (steelblue line). The shaded grey ribbon represents ±1 standard error around the predictions, illustrating forecast uncertainty.
</p>
</div>
</div>
<div id="model-selection" class="section level3" number="22.2.5">
<h3>
<span class="header-section-number">22.2.5</span> Model selection<a class="anchor" aria-label="anchor" href="#model-selection"><i class="fas fa-link"></i></a>
</h3>
<p>Selecting the appropriate model and its orders can be challenging, because there are multiple model types (AR, MA, ARMA, ARIMA) and many possible combinations of parameters (p, d, q). One common approach to guide model selection is the use of information criteria, such as the Akaike Information Criterion (AIC), which balance model fit and complexity.</p>
<p>This approach is conveniently implemented in the <code>forecast</code> package. In particular, the function <code>auto.arima()</code> automatically searches over a range of ARIMA models and selects the combination of parameters that yields the most parsimonious model for your data, simplifying the model selection process.</p>
<div class="sourceCode" id="cb589"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">auto.arima</span><span class="op">(</span></span>
<span>  <span class="va">df_huron</span><span class="op">$</span><span class="va">water_level</span>, <span class="co"># data</span></span>
<span>  stepwise <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># stepwise = FALSE: search all possible models rather than using stepwise approximation</span></span>
<span>  ic <span class="op">=</span> <span class="st">"aic"</span> <span class="co"># model selection based on AIC</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>## Series: df_huron$water_level 
## ARIMA(2,1,1) 
## 
## Coefficients:
##          ar1      ar2      ma1
##       0.9712  -0.2924  -0.9108
## s.e.  0.1137   0.1030   0.0712
## 
## sigma^2 = 0.5003:  log likelihood = -102.54
## AIC=213.07   AICc=213.51   BIC=223.37</code></pre>
<div class="sourceCode" id="cb591"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Possible extensions / additional arguments:</span></span>
<span><span class="co"># max.p, max.q       : maximum AR and MA orders to consider</span></span>
<span><span class="co"># d, D               : specify non-seasonal or seasonal differencing (or let auto.arima decide)</span></span>
<span><span class="co"># seasonal           : include seasonal ARIMA components (TRUE/FALSE)</span></span>
<span><span class="co"># max.P, max.Q       : maximum seasonal AR and MA orders</span></span>
<span><span class="co"># approximation      : use approximation for faster computation on long series</span></span>
<span><span class="co"># lambda             : Box-Cox transformation for stabilizing variance</span></span></code></pre></div>
<p>In this case, ARIMA(2,1,1) was selected, which suggests a non-stationary series with a shifting mean (due to differencing) and autocorrelations in the changes captured by the AR and MA terms.</p>
</div>
</div>
<div id="applied-models" class="section level2" number="22.3">
<h2>
<span class="header-section-number">22.3</span> Applied Models<a class="anchor" aria-label="anchor" href="#applied-models"><i class="fas fa-link"></i></a>
</h2>
<div id="galma-framework" class="section level3" number="22.3.1">
<h3>
<span class="header-section-number">22.3.1</span> GALMA framework<a class="anchor" aria-label="anchor" href="#galma-framework"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="galma-framework-1" class="section level3" number="22.3.2">
<h3>
<span class="header-section-number">22.3.2</span> GALMA framework<a class="anchor" aria-label="anchor" href="#galma-framework-1"><i class="fas fa-link"></i></a>
</h3>

</div>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="structural-equation-modeling.html"><span class="header-section-number">21</span> Structural Equation Modeling</a></div>
<div class="next"><a href="basic-terminology.html"><span class="header-section-number">23</span> Basic Terminology</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#time-series-analaysis"><span class="header-section-number">22</span> Time-Series Analaysis</a></li>
<li>
<a class="nav-link" href="#pitfall-of-time-series"><span class="header-section-number">22.1</span> Pitfall of Time-Series</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#time-series-anormalies"><span class="header-section-number">22.1.1</span> Time-series anormalies</a></li>
<li><a class="nav-link" href="#temporal-autocorrelation"><span class="header-section-number">22.1.2</span> Temporal autocorrelation</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#basic-models"><span class="header-section-number">22.2</span> Basic Models</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ar-model"><span class="header-section-number">22.2.1</span> AR Model</a></li>
<li><a class="nav-link" href="#ma-model"><span class="header-section-number">22.2.2</span> MA Model</a></li>
<li><a class="nav-link" href="#arma-model"><span class="header-section-number">22.2.3</span> ARMA Model</a></li>
<li><a class="nav-link" href="#arima-model"><span class="header-section-number">22.2.4</span> ARIMA model</a></li>
<li><a class="nav-link" href="#model-selection"><span class="header-section-number">22.2.5</span> Model selection</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#applied-models"><span class="header-section-number">22.3</span> Applied Models</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#galma-framework"><span class="header-section-number">22.3.1</span> GALMA framework</a></li>
<li><a class="nav-link" href="#galma-framework-1"><span class="header-section-number">22.3.2</span> GALMA framework</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/aterui/biostats/blob/master/chapters/adv-06-ts-analysis.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/aterui/biostats/edit/master/chapters/adv-06-ts-analysis.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>BIOSTATS</strong>" was written by Akira Terui. It was last built on 2025-12-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
